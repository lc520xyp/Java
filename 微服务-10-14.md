# 微服务-10-14

SpringCloud=分布式微服务架构的一站式解决方案，是多种微服务架构落地技术的集合体，俗称微服务全家桶

![image-20211014235130439](微服务-10-14/image-20211014235130439.png)

![image-20211014235218885](微服务-10-14/image-20211014235218885.png)

![image-20211014235507254](微服务-10-14/image-20211014235507254.png)

![image-20211015082041209](微服务-10-14/image-20211015082041209.png)

![image-20211015083242138](微服务-10-14/image-20211015083242138.png)



```
<!-- 1、只是声明依赖，并不实际引入，子项目按需声明使用的依赖 -->
<!-- 2、子项目可以继承父项目的 version 和 scope -->
<!-- 3、子项目若指定了 version 和 scope，以子项目为准 -->
<dependencyManagement>
 </dependencyManagement>
```



## 订单-支付模块微服务

1. 建model
2. 改POM
3. 写YML
4. 主启动
5. 业务类

一步步带着写code，

entities --> dao  --> mapper -->service --> serviceImpl --> Controller

### entities

```java
package com.atguigu.springcloud.entities;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * @author  liangchen
 * @create  2021/10/15 16:25
 * @desc
 **/
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Payment {
    private Long id;
    private String serial;
}
```

### dao

```java
package com.atguigu.springcloud.dao;

import com.atguigu.springcloud.entities.Payment;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

/**
 * @author  liangchen
 * @create  2021/10/15 16:38
 * @desc
 **/
@Mapper
public interface PaymentDao {
    public int create(Payment payment);
    public Payment getPaymentById(@Param("id") Long id);

}
```

### mapper

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.atguigu.springcloud.dao.PaymentDao">

	<!-- 必须会手打，不提示情况下 -->
    <insert id="creat" parameterType="Payment" useGeneratedKeys="true" keyProperty="id">
        insert into payment(serial) values(#{serial});
    </insert>
    
    <!--写resultMap是为了控制数据库里的列名和实体类中的名有一个对应关系，防止出错   -->
    <resultMap id="BaseResultMap" type="com.atguigu.springcloud.entities.Payment">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <id column="serial" property="serial" jdbcType="VARCHAR"/>
    </resultMap>
    <select id="getPaymentById" parameterType="Long" resultMap="BaseResultMap">
        select  * from payment where id=#{id}
    </select>


</mapper>

```

### service

```java
package com.atguigu.springcloud.service;

import com.atguigu.springcloud.entities.Payment;
import org.apache.ibatis.annotations.Param;


/**
 * @author  liangchen
 * @create  2021/10/15 17:10
 * @desc
 **/

public interface PaymentService {
    public int create(Payment payment);
    public Payment getPaymentById(@Param("id") Long id);

}
```

### serviceImpl

```java
package com.atguigu.springcloud.service.impl;

import com.atguigu.springcloud.dao.PaymentDao;
import com.atguigu.springcloud.entities.Payment;
import com.atguigu.springcloud.service.PaymentService;
import org.springframework.stereotype.Service;

import javax.annotation.Resource;

/**
 * @author  liangchen
 * @create  2021/10/15 17:11
 * @desc
 **/
@Service
public class PaymentServiceImpl implements PaymentService {

    @Resource
    private PaymentDao paymentDao;

    public int create(Payment payment){
        return paymentDao.create(payment);
    }
    public Payment getPaymentById(Long id){
        return paymentDao.getPaymentById(id);
    }

}
```

### Controller

```java
package com.atguigu.springcloud.controller;

import com.atguigu.springcloud.entities.CommonResult;
import com.atguigu.springcloud.entities.Payment;
import com.atguigu.springcloud.service.PaymentService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.annotation.Resource;

/**
 * @author  liangchen
 * @create  2021/10/15 17:16
 * @desc
 **/
@RestController
@Slf4j
public class PaymentController {
    @Resource
    private PaymentService paymentService;

    // 写操作， 真真正正操作，
    @PostMapping(value = "/payment/creat")
    public CommonResult creat(Payment payment){
        int result = paymentService.create(payment);
        log.info("*****插入结果："+ result);

        if(result > 0){
            return new CommonResult(200,"插入数据成功",result);
        }else {
            return new CommonResult(444,"插入失败", null);
        }
    }
    // 从数据库拉数据，取数据
    @GetMapping(value = "/payment/get/{id}")
    public CommonResult getPaymentById(@PathVariable("id") Long id){
        Payment payment = paymentService.getPaymentById(id);
        log.info("*****插入结果："+ payment);

        if(payment != null){
            return new CommonResult(200,"查询成功",payment);
        }else {
            return new CommonResult(444,"没有对应记录，查询ID是"+id, null);
        }
    }
}
```